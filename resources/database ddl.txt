CREATE TABLE IF NOT EXISTS user(
uID INT NOT NULL, AUTO_INCREMENT,
email VarChar(255) NOT NULL,
pass Char(128) NOT NULL,
picture VarChar(255),
f_name VarChar(255) NOT NULL,
m_name VarChar(255),
l_name VarChar(255) NOT NULL, 
tag_visibility TINYINT NOT NULL,
profile_visible TINYINT(1) NOT NULL,
block_invites TINYINT NOT NULL,
block_messages TINYINT NOT NULL,
PRIMARY KEY (uID)
);

CREATE TABLE IF NOT EXISTS groups(
gID INT NOT NULL AUTO_INCREMENT,
g_name VarChar(255) NOT NULL,
icon VarChar(255),
visible TINYINT NOT NULL,
burn_date DATETIME,
PRIMARY KEY (gID)
);

CREATE TABLE IF NOT EXISTS contacts(
uID INT NOT NULL,
contact INT NOT NULL,
PRIMARY KEY(uID, contact),
FOREIGN KEY (uID) REFERENCES user(uID) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (contact) REFERENCES user(uID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS members(
uID INT NOT NULL,
gID INT NOT NULL,
moderator TINYINT,
PRIMARY KEY(uID, gID),
FOREIGN KEY (uID) REFERENCES user(uID) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (gID) REFERENCES groups(gID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS conversation(
cID INT NOT NULL AUTO_INCREMENT,
c_name VarChar(255) NOT NULL,
PRIMARY KEY(cID)
);

CREATE TABLE IF NOT EXISTS message (
uID INT NOT NULL,
cID INT NOT NULL,
content VarChar(255),
date_time DATETIME NOT NULL,
PRIMARY KEY(uID, cID, date_time),
FOREIGN KEY (uID) REFERENCES user(uID) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (cID) REFERENCES conversation(cID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS tag (
tag_name VarChar(255) NOT NULL,
PRIMARY KEY(tag_name)
);

CREATE TABLE IF NOT EXISTS u_tagged (
uID INT NOT NULL,
tag_name VarChar(255) NOT NULL,
PRIMARY KEY(uID, tag_name),
FOREIGN KEY (uID) REFERENCES user(uID) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (tag_name) REFERENCES tag(tag_name) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS g_tagged (
gID INT NOT NULL,
tag_name VarChar(255) NOT NULL,
PRIMARY KEY(gID, tag_name),
FOREIGN KEY (gID) REFERENCES groups(gID) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (tag_name) REFERENCES tag(tag_name) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS moderator (
gID INT NOT NULL,
moderator INT NOT NULL,
PRIMARY KEY(gID, moderator),
FOREIGN KEY (gID) REFERENCES groups(gID) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (moderator) REFERENCES user(uID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS g_blocks (
gID INT NOT NULL,
uID INT NOT NULL,
PRIMARY KEY (uID,gID),
FOREIGN KEY (uID) REFERENCES user(uID) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (gID) REFERENCES groups(gID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS u_blocks (
blocker INT NOT NULL,
blocked INT NOT NULL,
PRIMARY KEY (blocker, blocked),
FOREIGN KEY (blocker) REFERENCES user(uID) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (blocked) REFERENCES user(uID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS post (
uID INT NOT NULL,
gID INT NOT NULL,
date_time DATETIME NOT NULL,
content TEXT NOT NULL,
edited TINYINT NOT NULL,
PRIMARY KEY(uID, gID, date_time),
FOREIGN KEY (uID) REFERENCES user(uID) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (gID) REFERENCES members(gID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS g_owns (
gID INT NOT NULL,
conversation INT NOT NULL,
o_participation TINYINT NOT NULL,
PRIMARY KEY(gID, conversation),
FOREIGN KEY (gID) REFERENCES members(gID) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (conversation) REFERENCES conversation(cID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS participates (
uID INT NOT NULL,
conversation INT NOT NULL,
PRIMARY KEY(uID,conversation),
FOREIGN KEY (uID) REFERENCES user(uID) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (conversation) REFERENCES conversation(cID) ON DELETE CASCADE ON UPDATE CASCADE
);